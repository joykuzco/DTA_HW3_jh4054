---
title: "p8105_hw3_jh4054"
author: "Joy Hsu"
date: "10/12/2018"
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: show
  
---

This R Markdown for HW3 reinforces skills from Data Visualization and Exploratory Data Analysis

### Setup

Load packages and set chunk options

```{r setup, collapse=TRUE}
library(tidyverse)
library(patchwork)
library(viridis)
library(janitor)
library(p8105.datasets)

knitr::opts_chunk$set(
  warning = FALSE, 
  message = FALSE)
```

### Problem 1

Import and clean dataset
```{r}
brfss = p8105.datasets::brfss_smart2010 %>% 
  janitor::clean_names() %>% 
  filter(topic == "Overall Health") %>% 
  select(
    -class, -topic, -question, -sample_size, 
    -c(confidence_limit_low:geo_location)) %>% 
  separate(locationdesc, into = c("rem1", "location"), sep = 5) %>% 
  select(-rem1) %>% 
  rename(state = locationabbr, proportion = data_value) %>% 
  mutate(response = factor(response, levels = c("Excellent","Very good", "Good", "Fair", "Poor"))) %>% 
  arrange(year, state, location)
```

Part 1. In 2002, responses for the Overall Health parameter was available for exactly 7 locations in 3 states: Connecticut, Florida, and North Carolina.

```{r}
brfss %>% 
  filter(year == 2002) %>% 
  distinct(state, location) %>% 
  group_by(state) %>% 
  summarise(number_locations = n()) %>% 
  filter(number_locations == 7) %>% 
  knitr::kable()
```

Part 2. spaghetti plot that shows the number of locations in each state from 2002 to 2010

```{r}
brfss %>% 
  group_by(state, year) %>% 
  distinct(state, location) %>% 
  summarise(number_locations = n()) %>% 
  ggplot(aes(x = year, y = number_locations, color = state)) +
    geom_line() +
    labs(
      title = "Number of Locations Represented in State",
      x = "Year",
      y = "Number of Locations",
      caption = "Data from the BRFSS dataset"
    ) + 
    viridis::scale_color_viridis(
      name = "State", 
      discrete = TRUE) +
    theme_bw() +  
    theme(legend.position = "bottom")
```

Part 3. 

In NY State, the average proportions of "Excellent" responses on the Overall Health questionnaire were 24.04%, 22.53%, and 22.70% in years 2002, 2006, and 2010, respectively. The standard deviation for proportion of "Excellent" responses were 4.49, 4.00, 3.57 in years 2002, 2006, and 2010, respectively.

```{r}
brfss %>% 
  filter(
    year %in% c(2002, 2006, 2010), 
    response == "Excellent",
    state == "NY") %>% 
  group_by(year) %>% 
  summarise(
    excellent_mean = mean(proportion),
    excellent_sd = sd(proportion)
  ) %>% 
  knitr::kable(digits = 2)

ungroup(brfss)
```

Part 4. 

```{r, collapse=TRUE}
mean_response = brfss %>% 
  group_by(year, state, response) %>% 
  summarise(avg_response = mean(proportion))

mean_response %>% 
  ggplot(aes(x = year, y = avg_response, color = state)) +
    geom_point() +
    labs(
      title = "State-Level Response Proportions by Year",
      x = "Year",
      y = "Average Proportion (%)",
      caption = "Data from the BRFSS dataset"
    ) + 
    facet_grid(~response) +   
    viridis::scale_color_viridis(
      name = "State", 
      discrete = TRUE) +
    theme_bw() +  
    theme(legend.position = "bottom")
```


